# Comparing `tmp/actoolkit-3.0.0b3-py3-none-any.whl.zip` & `tmp/actoolkit-3.0.0b4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,56 +1,56 @@
-Zip file size: 123247 bytes, number of entries: 54
--rw-r--r--  2.0 unx    10104 b- defN 24-Mar-19 15:24 toolkit.py
--rw-r--r--  2.0 unx     1139 b- defN 24-Mar-19 15:24 astraSDK/__init__.py
--rw-r--r--  2.0 unx     3659 b- defN 24-Mar-19 15:24 astraSDK/apiresources.py
--rw-r--r--  2.0 unx    16993 b- defN 24-Mar-19 15:24 astraSDK/apps.py
--rw-r--r--  2.0 unx     8289 b- defN 24-Mar-19 15:24 astraSDK/backups.py
--rw-r--r--  2.0 unx     7355 b- defN 24-Mar-19 15:24 astraSDK/buckets.py
--rw-r--r--  2.0 unx     6972 b- defN 24-Mar-19 15:24 astraSDK/clouds.py
--rw-r--r--  2.0 unx    10776 b- defN 24-Mar-19 15:24 astraSDK/clusters.py
--rw-r--r--  2.0 unx    14197 b- defN 24-Mar-19 15:24 astraSDK/common.py
--rw-r--r--  2.0 unx     9115 b- defN 24-Mar-19 15:24 astraSDK/credentials.py
--rw-r--r--  2.0 unx     2663 b- defN 24-Mar-19 15:24 astraSDK/entitlements.py
--rw-r--r--  2.0 unx     7958 b- defN 24-Mar-19 15:24 astraSDK/groups.py
--rw-r--r--  2.0 unx     7162 b- defN 24-Mar-19 15:24 astraSDK/hooks.py
--rw-r--r--  2.0 unx    42554 b- defN 24-Mar-19 15:24 astraSDK/k8s.py
--rw-r--r--  2.0 unx     5458 b- defN 24-Mar-19 15:24 astraSDK/namespaces.py
--rw-r--r--  2.0 unx     3576 b- defN 24-Mar-19 15:24 astraSDK/notifications.py
--rw-r--r--  2.0 unx     8803 b- defN 24-Mar-19 15:24 astraSDK/protections.py
--rw-r--r--  2.0 unx     9735 b- defN 24-Mar-19 15:24 astraSDK/replications.py
--rw-r--r--  2.0 unx     5757 b- defN 24-Mar-19 15:24 astraSDK/rolebindings.py
--rw-r--r--  2.0 unx     7090 b- defN 24-Mar-19 15:24 astraSDK/scripts.py
--rw-r--r--  2.0 unx     9821 b- defN 24-Mar-19 15:24 astraSDK/settings.py
--rw-r--r--  2.0 unx     7083 b- defN 24-Mar-19 15:24 astraSDK/snapshots.py
--rw-r--r--  2.0 unx     2434 b- defN 24-Mar-19 15:24 astraSDK/storagebackends.py
--rw-r--r--  2.0 unx     5023 b- defN 24-Mar-19 15:24 astraSDK/storageclasses.py
--rw-r--r--  2.0 unx     9007 b- defN 24-Mar-19 15:24 astraSDK/users.py
--rw-r--r--  2.0 unx      883 b- defN 24-Mar-19 15:24 tkSrc/__init__.py
--rw-r--r--  2.0 unx    31168 b- defN 24-Mar-19 15:24 tkSrc/choices.py
--rw-r--r--  2.0 unx     3962 b- defN 24-Mar-19 15:24 tkSrc/classes.py
--rw-r--r--  2.0 unx    24645 b- defN 24-Mar-19 15:24 tkSrc/clone.py
--rw-r--r--  2.0 unx     2011 b- defN 24-Mar-19 15:24 tkSrc/copy.py
--rw-r--r--  2.0 unx    27066 b- defN 24-Mar-19 15:24 tkSrc/create.py
--rw-r--r--  2.0 unx    10574 b- defN 24-Mar-19 15:24 tkSrc/deploy.py
--rw-r--r--  2.0 unx     9791 b- defN 24-Mar-19 15:24 tkSrc/destroy.py
--rw-r--r--  2.0 unx    26625 b- defN 24-Mar-19 15:24 tkSrc/helpers.py
--rw-r--r--  2.0 unx     4964 b- defN 24-Mar-19 15:24 tkSrc/ipr.py
--rw-r--r--  2.0 unx    19364 b- defN 24-Mar-19 15:24 tkSrc/list.py
--rw-r--r--  2.0 unx    17077 b- defN 24-Mar-19 15:24 tkSrc/manage.py
--rw-r--r--  2.0 unx    78921 b- defN 24-Mar-19 15:24 tkSrc/parser.py
--rw-r--r--  2.0 unx     7080 b- defN 24-Mar-19 15:24 tkSrc/unmanage.py
--rw-r--r--  2.0 unx    10304 b- defN 24-Mar-19 15:24 tkSrc/update.py
--rw-r--r--  2.0 unx      446 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/app.jinja
--rw-r--r--  2.0 unx      532 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/appVault.jinja
--rw-r--r--  2.0 unx      406 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/backup.jinja
--rw-r--r--  2.0 unx      374 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/hook.jinja
--rw-r--r--  2.0 unx      277 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/ipr.jinja
--rw-r--r--  2.0 unx      417 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/protection.jinja
--rw-r--r--  2.0 unx      584 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/restore.jinja
--rw-r--r--  2.0 unx      533 b- defN 24-Mar-19 15:24 tkSrc/templates/jinja/snapshot.jinja
--rw-r--r--  2.0 unx    11357 b- defN 24-Mar-19 15:24 actoolkit-3.0.0b3.dist-info/LICENSE
--rw-r--r--  2.0 unx     9193 b- defN 24-Mar-19 15:24 actoolkit-3.0.0b3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Mar-19 15:24 actoolkit-3.0.0b3.dist-info/WHEEL
--rw-r--r--  2.0 unx       43 b- defN 24-Mar-19 15:24 actoolkit-3.0.0b3.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       23 b- defN 24-Mar-19 15:24 actoolkit-3.0.0b3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     4254 b- defN 24-Mar-19 15:24 actoolkit-3.0.0b3.dist-info/RECORD
-54 files, 525689 bytes uncompressed, 116661 bytes compressed:  77.8%
+Zip file size: 123544 bytes, number of entries: 54
+-rw-r--r--  2.0 unx    10104 b- defN 24-Mar-21 21:29 toolkit.py
+-rw-r--r--  2.0 unx     1139 b- defN 24-Mar-21 21:29 astraSDK/__init__.py
+-rw-r--r--  2.0 unx     3659 b- defN 24-Mar-21 21:29 astraSDK/apiresources.py
+-rw-r--r--  2.0 unx    16993 b- defN 24-Mar-21 21:29 astraSDK/apps.py
+-rw-r--r--  2.0 unx     8289 b- defN 24-Mar-21 21:29 astraSDK/backups.py
+-rw-r--r--  2.0 unx     7355 b- defN 24-Mar-21 21:29 astraSDK/buckets.py
+-rw-r--r--  2.0 unx     6972 b- defN 24-Mar-21 21:29 astraSDK/clouds.py
+-rw-r--r--  2.0 unx    10776 b- defN 24-Mar-21 21:29 astraSDK/clusters.py
+-rw-r--r--  2.0 unx    14197 b- defN 24-Mar-21 21:29 astraSDK/common.py
+-rw-r--r--  2.0 unx     9115 b- defN 24-Mar-21 21:29 astraSDK/credentials.py
+-rw-r--r--  2.0 unx     2663 b- defN 24-Mar-21 21:29 astraSDK/entitlements.py
+-rw-r--r--  2.0 unx     7958 b- defN 24-Mar-21 21:29 astraSDK/groups.py
+-rw-r--r--  2.0 unx     7162 b- defN 24-Mar-21 21:29 astraSDK/hooks.py
+-rw-r--r--  2.0 unx    44673 b- defN 24-Mar-21 21:29 astraSDK/k8s.py
+-rw-r--r--  2.0 unx     5458 b- defN 24-Mar-21 21:29 astraSDK/namespaces.py
+-rw-r--r--  2.0 unx     3576 b- defN 24-Mar-21 21:29 astraSDK/notifications.py
+-rw-r--r--  2.0 unx     8803 b- defN 24-Mar-21 21:29 astraSDK/protections.py
+-rw-r--r--  2.0 unx     9735 b- defN 24-Mar-21 21:29 astraSDK/replications.py
+-rw-r--r--  2.0 unx     5757 b- defN 24-Mar-21 21:29 astraSDK/rolebindings.py
+-rw-r--r--  2.0 unx     7090 b- defN 24-Mar-21 21:29 astraSDK/scripts.py
+-rw-r--r--  2.0 unx     9821 b- defN 24-Mar-21 21:29 astraSDK/settings.py
+-rw-r--r--  2.0 unx     7083 b- defN 24-Mar-21 21:29 astraSDK/snapshots.py
+-rw-r--r--  2.0 unx     2434 b- defN 24-Mar-21 21:29 astraSDK/storagebackends.py
+-rw-r--r--  2.0 unx     5023 b- defN 24-Mar-21 21:29 astraSDK/storageclasses.py
+-rw-r--r--  2.0 unx     9007 b- defN 24-Mar-21 21:29 astraSDK/users.py
+-rw-r--r--  2.0 unx      883 b- defN 24-Mar-21 21:29 tkSrc/__init__.py
+-rw-r--r--  2.0 unx    31449 b- defN 24-Mar-21 21:29 tkSrc/choices.py
+-rw-r--r--  2.0 unx     3962 b- defN 24-Mar-21 21:29 tkSrc/classes.py
+-rw-r--r--  2.0 unx    24645 b- defN 24-Mar-21 21:29 tkSrc/clone.py
+-rw-r--r--  2.0 unx     2011 b- defN 24-Mar-21 21:29 tkSrc/copy.py
+-rw-r--r--  2.0 unx    27618 b- defN 24-Mar-21 21:29 tkSrc/create.py
+-rw-r--r--  2.0 unx    10646 b- defN 24-Mar-21 21:29 tkSrc/deploy.py
+-rw-r--r--  2.0 unx     9791 b- defN 24-Mar-21 21:29 tkSrc/destroy.py
+-rw-r--r--  2.0 unx    26802 b- defN 24-Mar-21 21:29 tkSrc/helpers.py
+-rw-r--r--  2.0 unx     4964 b- defN 24-Mar-21 21:29 tkSrc/ipr.py
+-rw-r--r--  2.0 unx    19364 b- defN 24-Mar-21 21:29 tkSrc/list.py
+-rw-r--r--  2.0 unx    17049 b- defN 24-Mar-21 21:29 tkSrc/manage.py
+-rw-r--r--  2.0 unx    79092 b- defN 24-Mar-21 21:29 tkSrc/parser.py
+-rw-r--r--  2.0 unx     7187 b- defN 24-Mar-21 21:29 tkSrc/unmanage.py
+-rw-r--r--  2.0 unx    10304 b- defN 24-Mar-21 21:29 tkSrc/update.py
+-rw-r--r--  2.0 unx      446 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/app.jinja
+-rw-r--r--  2.0 unx      532 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/appVault.jinja
+-rw-r--r--  2.0 unx      406 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/backup.jinja
+-rw-r--r--  2.0 unx      374 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/hook.jinja
+-rw-r--r--  2.0 unx      277 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/ipr.jinja
+-rw-r--r--  2.0 unx      417 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/protection.jinja
+-rw-r--r--  2.0 unx      584 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/restore.jinja
+-rw-r--r--  2.0 unx      533 b- defN 24-Mar-21 21:29 tkSrc/templates/jinja/snapshot.jinja
+-rw-r--r--  2.0 unx    11357 b- defN 24-Mar-21 21:29 actoolkit-3.0.0b4.dist-info/LICENSE
+-rw-r--r--  2.0 unx     9193 b- defN 24-Mar-21 21:29 actoolkit-3.0.0b4.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Mar-21 21:29 actoolkit-3.0.0b4.dist-info/WHEEL
+-rw-r--r--  2.0 unx       43 b- defN 24-Mar-21 21:29 actoolkit-3.0.0b4.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       23 b- defN 24-Mar-21 21:29 actoolkit-3.0.0b4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     4254 b- defN 24-Mar-21 21:29 actoolkit-3.0.0b4.dist-info/RECORD
+54 files, 529140 bytes uncompressed, 116958 bytes compressed:  77.9%
```

## zipnote {}

```diff
@@ -138,26 +138,26 @@
 
 Filename: tkSrc/templates/jinja/restore.jinja
 Comment: 
 
 Filename: tkSrc/templates/jinja/snapshot.jinja
 Comment: 
 
-Filename: actoolkit-3.0.0b3.dist-info/LICENSE
+Filename: actoolkit-3.0.0b4.dist-info/LICENSE
 Comment: 
 
-Filename: actoolkit-3.0.0b3.dist-info/METADATA
+Filename: actoolkit-3.0.0b4.dist-info/METADATA
 Comment: 
 
-Filename: actoolkit-3.0.0b3.dist-info/WHEEL
+Filename: actoolkit-3.0.0b4.dist-info/WHEEL
 Comment: 
 
-Filename: actoolkit-3.0.0b3.dist-info/entry_points.txt
+Filename: actoolkit-3.0.0b4.dist-info/entry_points.txt
 Comment: 
 
-Filename: actoolkit-3.0.0b3.dist-info/top_level.txt
+Filename: actoolkit-3.0.0b4.dist-info/top_level.txt
 Comment: 
 
-Filename: actoolkit-3.0.0b3.dist-info/RECORD
+Filename: actoolkit-3.0.0b4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## astraSDK/k8s.py

```diff
@@ -19,15 +19,15 @@
 import copy
 import json
 import kubernetes
 import sys
 import yaml
 from datetime import datetime, timedelta, timezone
 
-from .common import KubeCommon, SDKCommon
+from .common import BaseCommon, KubeCommon, SDKCommon
 
 
 class getResources(KubeCommon):
     """Get all namespace scoped resources of a specific CRD"""
 
     def __init__(
         self, quiet=True, output="json", verbose=False, config_context=None, skip_tls_verify=False
@@ -917,15 +917,15 @@
             dry_run=self.dry_run,
             verbose=self.verbose,
             config_context=self.config_context,
             skip_tls_verify=self.skip_tls_verify,
         ).main(secret, namespace=namespace)
 
 
-class createGenericSecret(KubeCommon, SDKCommon):
+class createGenericSecret(KubeCommon):
     """Creates a basic Kubernetes secret, the passed data must already be base64 encoded"""
 
     def __init__(
         self, quiet=True, dry_run=False, verbose=False, config_context=None, skip_tls_verify=False
     ):
         """quiet: Will there be CLI output or just return (datastructure)
         dry-run: False (default):       submit and persist the resource
@@ -1014,14 +1014,64 @@
             },
         }
         return createResource(
             quiet=self.quiet,
             dry_run=self.dry_run,
             verbose=self.verbose,
             config_context=self.config_context,
+            skip_tls_verify=self.skip_tls_verify,
+        ).main(
+            body["kind"].lower() + "s",
+            namespace,
+            body,
+            version=body["apiVersion"].split("/")[1],
+            group=body["apiVersion"].split("/")[0],
+        )
+
+
+class createHeadlessConnector(BaseCommon):
+    """Creates an AstraConnector custom resource without registering to Astra Control"""
+
+    def __init__(
+        self, quiet=True, dry_run=False, verbose=False, config_context=None, skip_tls_verify=False
+    ):
+        """quiet: Will there be CLI output or just return (datastructure)
+        dry-run: False (default):       submit and persist the resource
+                 True or non-empty str: submit request without persisting the resource
+        verbose: Print all of the rest call info: URL, Method, Headers, Request Body
+        config_context: the kubeconfig:context mapping to execute against
+                        None: use system defaults
+                        str "None:<context>": use default kubeconfig w/ specified context
+                        str "<config_file>:<context>": use specified file and context
+        skip_tls_verify: Whether to skip TLS/SSL verification"""
+        self.quiet = quiet
+        self.dry_run = dry_run
+        self.verbose = verbose
+        self.config_context = config_context
+        self.skip_tls_verify = skip_tls_verify
+        super().__init__()
+
+    def main(
+        self, clusterName, regCred, registry, name="astra-connector", namespace="astra-connector"
+    ):
+        body = {
+            "apiVersion": "astra.netapp.io/v1",
+            "kind": "AstraConnector",
+            "metadata": {"name": name, "namespace": namespace},
+            "spec": {
+                "astra": {"clusterName": clusterName},
+                "natsSyncClient": {"cloudBridgeURL": "127.0.0.1"},
+                "imageRegistry": {"name": registry, "secret": regCred},
+            },
+        }
+        return createResource(
+            quiet=self.quiet,
+            dry_run=self.dry_run,
+            verbose=self.verbose,
+            config_context=self.config_context,
             skip_tls_verify=self.skip_tls_verify,
         ).main(
             body["kind"].lower() + "s",
             namespace,
             body,
             version=body["apiVersion"].split("/")[1],
             group=body["apiVersion"].split("/")[0],
```

## tkSrc/choices.py

```diff
@@ -277,24 +277,30 @@
                                             "service-account",
                                         ]:
                                             credID = credential["id"]
                             if credID:
                                 acl.credentials.append(credential["id"])
         elif argv[verbPosition + 1] == "cluster":
             if v3:
-                ard.clouds = astraSDK.clouds.getClouds().main()
-                if ard.clouds and ard.clouds.get("items"):
-                    for cloud in ard.clouds["items"]:
-                        if cloud["cloudType"] not in ["GCP", "Azure", "AWS"]:
-                            acl.clouds.append(cloud["id"])
-                # Add a private cloud if it doesn't already exist
-                if len(acl.clouds) == 0:
-                    rc = astraSDK.clouds.manageCloud(quiet=True).main("private", "private")
-                    if rc:
-                        acl.clouds.append(rc["id"])
+                if "--headless" in argv:
+                    acl.clouds.append("123")
+                else:
+                    try:
+                        ard.clouds = astraSDK.clouds.getClouds().main()
+                        if ard.clouds and ard.clouds.get("items"):
+                            for cloud in ard.clouds["items"]:
+                                if cloud["cloudType"] not in ["GCP", "Azure", "AWS"]:
+                                    acl.clouds.append(cloud["id"])
+                        # Add a private cloud if it doesn't already exist
+                        if len(acl.clouds) == 0:
+                            rc = astraSDK.clouds.manageCloud(quiet=True).main("private", "private")
+                            if rc:
+                                acl.clouds.append(rc["id"])
+                    except SystemExit:
+                        pass
                 ard.credentials = astraSDK.k8s.getSecrets(
                     config_context=v3, skip_tls_verify=v3_skip_tls_verify
                 ).main()
                 acl.credentials = ard.buildList("credentials", "metadata.name")
             else:
                 ard.clusters = astraSDK.clusters.getClusters().main()
                 acl.clusters = ard.buildList(
```

## tkSrc/create.py

```diff
@@ -13,14 +13,15 @@
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
 """
 
 import base64
 import json
+import os
 import sys
 import time
 import yaml
 
 import astraSDK
 from tkSrc import helpers
 
@@ -70,14 +71,25 @@
         except Exception as err:
             err_counter.append(err)
     for err in set([str(e) for e in err_counter]):
         protection_class.printError(err + "\n")
     return False
 
 
+def createV3ConnectorOperator(v3, dry_run, skip_tls_verify, verbose, operator_version):
+    """Creates the Arch 3.0 Astra Connector Operator"""
+    context, config_file = tuple(v3.split("@"))
+    helpers.run(
+        f"kubectl --insecure-skip-tls-verify={skip_tls_verify} --context={context} "
+        f"-v={6 if verbose else 0} apply --dry_run={dry_run if dry_run else 'none'} -f "
+        f"{helpers.getOperatorURL(operator_version)}",
+        env={"KUBECONFIG": os.path.expanduser(config_file)} if config_file != "None" else None,
+    )
+
+
 def createCloudCredential(quiet, verbose, path, name, cloudType, parser):
     """Create a public cloud (AWS/Azure/GCP) credential via the API"""
     credDict = helpers.openJson(path, parser)
     encodedStr = base64.b64encode(json.dumps(credDict).encode("utf-8")).decode("utf-8")
     rc = astraSDK.credentials.createCredential(quiet=quiet, verbose=verbose).main(
         "astra-sa@" + name,
         "service-account",
```

## tkSrc/deploy.py

```diff
@@ -151,15 +151,15 @@
                             raise SystemExit("Error managing app")
 
         # Create a protection policy on that namespace (using its appID)
         time.sleep(5)
         backupRetention = "1"
         snapshotRetention = "1"
         minute = "0"
-        cpp = astraSDK.protections.createProtectionpolicy(quiet=True)
+        cpp = astraSDK.protections.createProtectionpolicy(quiet=quiet)
         cppData = {
             "hourly": {"dayOfWeek": "*", "dayOfMonth": "*", "hour": "*"},
             "daily": {"dayOfWeek": "*", "dayOfMonth": "*", "hour": "2"},
             "weekly": {"dayOfWeek": "0", "dayOfMonth": "*", "hour": "2"},
             "monthly": {"dayOfWeek": "*", "dayOfMonth": "1", "hour": "2"},
         }
         for period in cppData:
@@ -248,14 +248,16 @@
                 raise SystemExit("astraSDK.k8s.updateClusterResource() failed")
         else:
             parser.error(
                 "'deploy acp' is currently only supported as a --v3 command, please re-run with "
                 "--v3 and an optional context, kubeconfig_file, or context@kubeconfig_file mapping"
             )
     elif args.objectType == "chart":
+        if not hasattr(args, "bucket"):
+            args.bucket = None
         deployHelm(
             args.chart,
             helpers.isRFC1123(args.app, parser=parser),
             args.namespace,
             args.set,
             args.values,
             args.bucket,
```

## tkSrc/helpers.py

```diff
@@ -565,17 +565,21 @@
         parser.error(f"'{sourceAppVaultRef}' not found on the source cluster,\n{sourceAppVaults=}")
     except KeyError as err:
         parser.error(f"{err} key not found in '{sourceAppVaultRef}' object,\n{sourceAppVaults=}")
     try:
         destAppVault = next(a for a in destAppVaults["items"] if a["status"]["uid"] == sourceUid)
         return destAppVault["metadata"]["name"]
     except StopIteration:
+        destAppVaultSum = [
+            {"name": d["metadata"]["name"], "uid": d["status"]["uid"]}
+            for d in destAppVaults["items"]
+        ]
         parser.error(
             f"An appVault with status.uid of '{sourceUid}' not found on the destination cluster,"
-            f"\n{destAppVaults=}"
+            f" destination app vaults: {destAppVaultSum}"
         )
     except KeyError as err:
         parser.error(f"{err} key not found in 'destAppVault' object,\n{destAppVaults=}")
 
 
 def openJson(path, parser):
     """Given a file path, open the json file, and return a dict of its contents"""
```

## tkSrc/manage.py

```diff
@@ -11,15 +11,14 @@
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
 """
 
-import os
 import yaml
 
 import astraSDK
 from tkSrc import create, helpers
 
 
 def manageV3App(
@@ -137,14 +136,79 @@
             v3_dict["metadata"]["namespace"],
             v3_dict,
             version="v1",
             group="astra.netapp.io",
         )
 
 
+def manageV3Cluster(
+    v3,
+    dry_run,
+    skip_tls_verify,
+    quiet,
+    verbose,
+    clusterName,
+    operator_version,
+    regCred,
+    registry,
+    cloudID,
+    headless,
+    ard,
+    parser,
+):
+    helpers.isRFC1123(clusterName, parser=parser)
+    create.createV3ConnectorOperator(v3, dry_run, skip_tls_verify, verbose, operator_version)
+    # Create the astra API token secret
+    if not headless:
+        apiToken = astraSDK.k8s.createAstraApiToken(
+            quiet=quiet,
+            dry_run=dry_run,
+            verbose=verbose,
+            config_context=v3,
+            skip_tls_verify=skip_tls_verify,
+        ).main()
+    # Handle the registry secret
+    if not regCred:
+        cred = astraSDK.k8s.createRegCred(
+            quiet=quiet,
+            dry_run=dry_run,
+            verbose=verbose,
+            config_context=v3,
+            skip_tls_verify=skip_tls_verify,
+        ).main(registry=registry, namespace="astra-connector")
+        if not cred:
+            raise SystemExit("astraSDK.k8s.createRegCred() failed")
+        regCred = cred["metadata"]["name"]
+    else:
+        if ard.needsattr("credentials"):
+            ard.credentials = astraSDK.k8s.getSecrets(
+                config_context=v3, skip_tls_verify=skip_tls_verify
+            ).main()
+        cred = ard.getSingleDict("credentials", "metadata.name", regCred, parser)
+    # Create the AstraConnector CR
+    if headless:
+        connector = astraSDK.k8s.createHeadlessConnector(
+            quiet=quiet,
+            dry_run=dry_run,
+            verbose=verbose,
+            config_context=v3,
+            skip_tls_verify=skip_tls_verify,
+        ).main(clusterName, regCred, registry)
+    else:
+        connector = astraSDK.k8s.createAstraConnector(
+            quiet=quiet,
+            dry_run=dry_run,
+            verbose=verbose,
+            config_context=v3,
+            skip_tls_verify=skip_tls_verify,
+        ).main(clusterName, cloudID, apiToken["metadata"]["name"], regCred, registry=registry)
+    if not connector:
+        raise SystemExit("astraSDK.k8s.createAstraConnector() failed")
+
+
 def validateBucketArgs(args, parser):
     """Validate that user provided inputs for managing a bucket are valid"""
     # Validate serverURL and storageAccount args depending upon provider type
     if args.serverURL is None and args.provider in [
         "aws",
         "generic-s3",
         "ontap-s3",
@@ -339,68 +403,29 @@
                 args.credential,
                 args.quiet,
                 args.verbose,
             )
 
     elif args.objectType == "cluster":
         if args.v3:
-            # Validate the inputted cluster name conforms to RFC-1123 prior to installing resources
-            helpers.isRFC1123(args.clusterName, parser=parser)
-            # Install the operator
-            context, config_file = tuple(args.v3.split("@"))
-            helpers.run(
-                f"kubectl --context={context} -v={6 if args.verbose else 0} apply "
-                f"--dry_run={args.dry_run if args.dry_run else 'none'} -f "
-                f"{helpers.getOperatorURL(args.operator_version)}",
-                env={"KUBECONFIG": os.path.expanduser(config_file)}
-                if config_file != "None"
-                else None,
-            )
-            # Create the astra API token secret
-            apiToken = astraSDK.k8s.createAstraApiToken(
-                quiet=args.quiet,
-                dry_run=args.dry_run,
-                verbose=args.verbose,
-                config_context=args.v3,
-                skip_tls_verify=args.skip_tls_verify,
-            ).main()
-            # Handle the registry secret
-            if not args.regCred:
-                cred = astraSDK.k8s.createRegCred(
-                    quiet=args.quiet,
-                    dry_run=args.dry_run,
-                    verbose=args.verbose,
-                    config_context=args.v3,
-                    skip_tls_verify=args.skip_tls_verify,
-                ).main(registry=args.registry, namespace="astra-connector")
-                if not cred:
-                    raise SystemExit("astraSDK.k8s.createRegCred() failed")
-                args.regCred = cred["metadata"]["name"]
-            else:
-                if ard.needsattr("credentials"):
-                    ard.credentials = astraSDK.k8s.getSecrets(
-                        config_context=args.v3, skip_tls_verify=args.skip_tls_verify
-                    ).main()
-                cred = ard.getSingleDict("credentials", "metadata.name", args.regCred, parser)
-            # Create the AstraConnector CR
-            connector = astraSDK.k8s.createAstraConnector(
-                quiet=args.quiet,
-                dry_run=args.dry_run,
-                verbose=args.verbose,
-                config_context=args.v3,
-                skip_tls_verify=args.skip_tls_verify,
-            ).main(
+            manageV3Cluster(
+                args.v3,
+                args.dry_run,
+                args.skip_tls_verify,
+                args.quiet,
+                args.verbose,
                 args.clusterName,
-                args.cloudID,
-                apiToken["metadata"]["name"],
+                args.operator_version,
                 args.regCred,
-                registry=args.registry,
+                args.registry,
+                args.cloudID,
+                args.headless,
+                ard,
+                parser,
             )
-            if not connector:
-                raise SystemExit("astraSDK.k8s.createAstraConnector() failed")
         else:
             rc = astraSDK.clusters.manageCluster(quiet=args.quiet, verbose=args.verbose).main(
                 args.cluster, args.defaultStorageClassID
             )
             if rc is False:
                 raise SystemExit("astraSDK.clusters.manageCluster() failed")
```

## tkSrc/parser.py

```diff
@@ -1742,15 +1742,15 @@
                 required=(False if len(self.acl.clouds) == 1 else True),
                 help="The cloudID to add the cluster to (only required if # of clouds > 1)",
             )
             self.subparserManageCluster.add_argument(
                 "-v",
                 "--operator-version",
                 required=False,
-                default="latest",
+                default="24.02.0-202403151353",
                 help="Optionally specify the astra-connector-operator version "
                 "(default: %(default)s)",
             )
             self.subparserManageCluster.add_argument(
                 "--regCred",
                 choices=(None if self.plaidMode else self.acl.credentials),
                 default=None,
@@ -1759,14 +1759,17 @@
             )
             self.subparserManageCluster.add_argument(
                 "--registry",
                 default=None,
                 help="optionally specify the FQDN of the ACP image source registry "
                 "(defaults to cr.<astra-control-fqdn>)",
             )
+            self.subparserManageCluster.add_argument(
+                "--headless", action="store_true", default=False, help=argparse.SUPPRESS
+            )
         else:
             self.subparserManageCluster.add_argument(
                 "cluster",
                 choices=(None if self.plaidMode else self.acl.clusters),
                 help="clusterID of the cluster to manage",
             )
             self.subparserManageCluster.add_argument(
```

## tkSrc/unmanage.py

```diff
@@ -73,25 +73,26 @@
                 skip_tls_verify=args.skip_tls_verify,
             ).main(
                 "astraconnectors",
                 connector["metadata"]["name"],
                 version="v1",
                 group="astra.netapp.io",
             ):
-                if not astraSDK.k8s.destroySecret(
-                    quiet=args.quiet,
-                    dry_run=args.dry_run,
-                    verbose=args.verbose,
-                    config_context=args.v3,
-                    skip_tls_verify=args.skip_tls_verify,
-                ).main(
-                    connector["spec"]["astra"]["tokenRef"],
-                    namespace=connector["metadata"]["namespace"],
-                ):
-                    raise SystemExit("astraSDK.k8s.destroySecret() failed")
+                if connector["spec"]["astra"].get("tokenRef"):
+                    if not astraSDK.k8s.destroySecret(
+                        quiet=args.quiet,
+                        dry_run=args.dry_run,
+                        verbose=args.verbose,
+                        config_context=args.v3,
+                        skip_tls_verify=args.skip_tls_verify,
+                    ).main(
+                        connector["spec"]["astra"]["tokenRef"],
+                        namespace=connector["metadata"]["namespace"],
+                    ):
+                        raise SystemExit("astraSDK.k8s.destroySecret() failed")
             else:
                 raise SystemExit("astraSDK.k8s.destroyResource() failed")
         else:
             if astraSDK.clusters.unmanageCluster(quiet=args.quiet, verbose=args.verbose).main(
                 args.cluster
             ):
                 # "Private" cloud clusters+credentials also should be deleted
```

## Comparing `actoolkit-3.0.0b3.dist-info/LICENSE` & `actoolkit-3.0.0b4.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `actoolkit-3.0.0b3.dist-info/METADATA` & `actoolkit-3.0.0b4.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: actoolkit
-Version: 3.0.0b3
+Version: 3.0.0b4
 Summary: Toolkit and SDK for interacting with Astra Control
 Home-page: https://github.com/NetApp/netapp-astra-toolkits
 Author: Michael Haigh
 Author-email: Michael.Haigh@netapp.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: Apache Software License
 Classifier: Operating System :: OS Independent
```

## Comparing `actoolkit-3.0.0b3.dist-info/RECORD` & `actoolkit-3.0.0b4.dist-info/RECORD`

 * *Files 9% similar despite different names*

```diff
@@ -7,48 +7,48 @@
 astraSDK/clouds.py,sha256=qcE1r0WbU3v3JSIF17Jlbsnv81kLE0M_uI8xFwqV5s0,6972
 astraSDK/clusters.py,sha256=GIFDwGJBeXeYgMkNd5lFjmGZrDYWjrzqos9YYot5X2k,10776
 astraSDK/common.py,sha256=V1fCdMbvgioMuXLcImsXAa8BTrQwMtXi5rzbNJiAQ0o,14197
 astraSDK/credentials.py,sha256=tmvbJ9YwiqUhP0WKcSIysRYSB9gkCwXyVhYeKXB8xiA,9115
 astraSDK/entitlements.py,sha256=cWfWWEG-3i1aZbpKxD9adNaIcY50Ezm5Ykszu_sfp2A,2663
 astraSDK/groups.py,sha256=YoGysVgQGkJLw7VKUZBdBx8lC1B-9rNFqvFhrKdVRCc,7958
 astraSDK/hooks.py,sha256=7ato-tpUjzm2p8EWybGLVRhKnqvEOJpdRVGIqUuxp0c,7162
-astraSDK/k8s.py,sha256=KmTjXiqFoz1T_3Sb6HV1IkUXqOP4xIuWTGwaCjvpIb0,42554
+astraSDK/k8s.py,sha256=-_uRkwVOl_sA3qdNeS1sWf3E2VXYHbrsuLF2vFjJqS8,44673
 astraSDK/namespaces.py,sha256=NExkodJpRKHPbDlpAxcCcmp5vGaHV8JFrCXi02LQwFQ,5458
 astraSDK/notifications.py,sha256=cnurpqSBXwRL-vTNxp6SYAl-xz7qzJnLT6w8kwBo4r4,3576
 astraSDK/protections.py,sha256=qQSqm-uFBbO6TReLH-8hC0e5ZRFSBLmuhYxK8EZVdRE,8803
 astraSDK/replications.py,sha256=1sFZtKDZ1k_0Y2f7V71ZZzoNP1vkR-3Xk8ESHB7j4gQ,9735
 astraSDK/rolebindings.py,sha256=C_fTyegWZ1XLaajIzI_ftybpkLEsPMnCmyn4mNn3g1M,5757
 astraSDK/scripts.py,sha256=AHMjcDhE5am8PhbUhALh7W22h2lSFe99qDRHTasGjtQ,7090
 astraSDK/settings.py,sha256=FjLCGalV_CVq_aQXixAPTe0GDCNYYV3NopLtVlk0_80,9821
 astraSDK/snapshots.py,sha256=P3FU7zUMnmAYmlorYp_qq1knU24Fa3VrymvS_Pn-hVg,7083
 astraSDK/storagebackends.py,sha256=U4xh-hv5P7ip69Je6e9HIqhGPusU0VukHmzugtUpk_o,2434
 astraSDK/storageclasses.py,sha256=YKMkLFqALreDcUPs1xQzzsadzLZPaLXmuwuJbKoMlXk,5023
 astraSDK/users.py,sha256=nuUS9llQ8I75XEjkRlWvFaai9Kg_VAIO9U7UK7xeKfo,9007
 tkSrc/__init__.py,sha256=bEBPw__Mr4AQFYM-nje4IiKl3_0ljSg_WvdfKItXS20,883
-tkSrc/choices.py,sha256=8qwD23mqp5QGJlevcOxevNY2QZK0SFex72xmayCnYQQ,31168
+tkSrc/choices.py,sha256=2F379AD9Uon06MS0MK3YDIDaccaul_CelaVsnJey2_M,31449
 tkSrc/classes.py,sha256=a7CZwV9WgT4eNytrPQiAtmR_EMUQH7N7OyW-EhIbGU0,3962
 tkSrc/clone.py,sha256=BEBC8-lFODegWluIkA3OoY8YVnaOwqZ2S8veyqARNjk,24645
 tkSrc/copy.py,sha256=sIiVt1gE4IJVJmwxXiHlhj-jKmYFrYSxdx3COSGG534,2011
-tkSrc/create.py,sha256=RFKVIHxf6RozrsBH9t3VXYnVnOcKq4-0arvtVKHkI6o,27066
-tkSrc/deploy.py,sha256=r49thXnaxC5p3CN6JFl1hxQX5kOlEkqB2Jwnt6Rhq4k,10574
+tkSrc/create.py,sha256=pD61qjwrVvTsk4ko4jGo0mTk__4JnF2YXcekc_uJK3k,27618
+tkSrc/deploy.py,sha256=VDBMHvkVSPX1UU3yZqIh8MkLyqE0NPAy3E_vyd9xIbA,10646
 tkSrc/destroy.py,sha256=kBMvuLjTCKTgxnjG7P0lQaWdpGktMIYP5ElXqFClzMM,9791
-tkSrc/helpers.py,sha256=1h7IHgTrQGyZpRltOKT6ylq7pqOsS6Z1PowEInmvtp4,26625
+tkSrc/helpers.py,sha256=UlZMP9948hjKqbBlFBCRBwqwXtAXHEJMPHnGaIxKHV8,26802
 tkSrc/ipr.py,sha256=fxJWqGVHCffaynh9udAq-7p262-XH55UstIU_yRSPLQ,4964
 tkSrc/list.py,sha256=qy43Uh-rdTFGnlBtGZpJfgTp3DYHcJim0WCBL1pkCEY,19364
-tkSrc/manage.py,sha256=xs-Pv_0jbpE4wotP8CZ49pLvWqE7vKFc3sz1J5raNa4,17077
-tkSrc/parser.py,sha256=LuAtifTB5p6qW6C3tsNgtmBIgUxert9JHhhKhwPq1aI,78921
-tkSrc/unmanage.py,sha256=BauhgB5W8Q5tyAPwRplNnWUDa5YVah4OI2Fg-rxiMWg,7080
+tkSrc/manage.py,sha256=UCkbzcFlTUpqDRIG7rzfTWmTEmMoSgwwmiEOL0f1_FQ,17049
+tkSrc/parser.py,sha256=zbNamUCurQsOhGUb0zg70CdrzKWp-GV60Bh4nFX0mHM,79092
+tkSrc/unmanage.py,sha256=rrpHGXOQPBGYKkHUTTKMy8CnAMRhpBu_EzVEWionIo4,7187
 tkSrc/update.py,sha256=rUu9mkIsbHTUNtj0YeOxv0nP4fG8zx7s-jlLFNfxKzU,10304
 tkSrc/templates/jinja/app.jinja,sha256=6hkzd1kb3M2NWv1fOHERBacuIZ6Y4f-ymJthwPWHaF8,446
 tkSrc/templates/jinja/appVault.jinja,sha256=pJccPuk1Co6oGvwqYwy0kHGoLGtrmKqLMewYLovSYcU,532
 tkSrc/templates/jinja/backup.jinja,sha256=0m1Z-plkxS8xIa8QgmnnR5eNaLxHQkM1EJwgTGKOPF0,406
 tkSrc/templates/jinja/hook.jinja,sha256=shg7mtmw-pxyQPvc1ApJBk9h1ra33X5zWY6QXVnemE0,374
 tkSrc/templates/jinja/ipr.jinja,sha256=o24Gd86lkZicpwrlRRxz2asvQBDzGGpv8q7XGeNKO9A,277
 tkSrc/templates/jinja/protection.jinja,sha256=W2kXOkrkSLoHuAJJY3RFesc0HF_LSyuJ5dFBBMiwE-U,417
 tkSrc/templates/jinja/restore.jinja,sha256=yofEKvIBF5dwBVbdjIlLBoMk99JR9h97HzUmBbYaNw0,584
 tkSrc/templates/jinja/snapshot.jinja,sha256=kyEShlXwosIr7jYbywD-VcuaezhI2HpXYvVDleC7KzU,533
-actoolkit-3.0.0b3.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-actoolkit-3.0.0b3.dist-info/METADATA,sha256=GF2WoPk8KkWMM0nyjDzpyo3TbYaJ5_bCap-XSEB_Kdw,9193
-actoolkit-3.0.0b3.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-actoolkit-3.0.0b3.dist-info/entry_points.txt,sha256=MdrJm8ktNHa01CEY7q5irB9JDPT_qg6hVpZWUhbKXWU,43
-actoolkit-3.0.0b3.dist-info/top_level.txt,sha256=wWyEWMBpCvR7Kv5mt_hBl4SEOLoVTV_9blXZhzBu7Y8,23
-actoolkit-3.0.0b3.dist-info/RECORD,,
+actoolkit-3.0.0b4.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+actoolkit-3.0.0b4.dist-info/METADATA,sha256=bduAvP7sw690rV1kKy3OMEvu7Rx61Sx6Y9nFDZvkG-U,9193
+actoolkit-3.0.0b4.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+actoolkit-3.0.0b4.dist-info/entry_points.txt,sha256=MdrJm8ktNHa01CEY7q5irB9JDPT_qg6hVpZWUhbKXWU,43
+actoolkit-3.0.0b4.dist-info/top_level.txt,sha256=wWyEWMBpCvR7Kv5mt_hBl4SEOLoVTV_9blXZhzBu7Y8,23
+actoolkit-3.0.0b4.dist-info/RECORD,,
```

